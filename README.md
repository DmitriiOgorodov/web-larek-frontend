# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

```
API_ORIGIN=https://larek-api.nomoreparties.co
```
Это задаёт адрес API-сервера.

## Описание базовых классов
1. **EventEmitter**
Реализует паттерн "Наблюдатель" для управления событиями в приложении. Используется для коммуникации между компонентами и моделью данных, например, для открытия модального окна, обновления корзины или отправки заказа.
Функции:
- Установка (on) и удаление (off) обработчиков событий.
- Вызов обработчиков при возникновении события (emit).
- Поддержка глобального слушателя событий (onAll) для отладки.
Создание триггеров событий (trigger) для упрощения генерации событий.

2. **Model**
Базовый класс для моделей данных, обеспечивающий интеграцию с событиями.
Функции:
- Хранение данных через конструктор с частичной типизацией (Partial<T>).
- Генерация событий при изменении данных (emitChanges).
Используется в AppState и ProductItem для управления состоянием приложения и данными товаров.

3. **Component**
Базовый класс для UI-компонентов, работающих с DOM.
Функции:
- Управление DOM-элементами: установка текста (setText), изображений (setImage), переключение классов (toggleClass), управление состоянием disabled (setDisabled).
- Скрытие/показ элементов (setHidden, setVisible).
- Рендеринг компонента с обновлением данных (render).
Используется в компонентах Page, Modal, Basket, Card, Success и других для работы с интерфейсом.

4. **Api**
Базовый класс для работы с REST API.
Функции:
- Выполнение GET-запросов (get) и POST/PUT/DELETE-запросов (post).
- Обработка ответов сервера (handleResponse).
Расширяется в LarekAPI для взаимодействия с сервером магазина.

## Вспомогательный код
**LarekAPI**
Выполняет запросы к серверу для получения списка товаров, данных о товаре и отправки заказа.
Используется AppState для инициализации каталога (setCatalog) и отправки заказа (orderProducts).
Данные: Список товаров (IProduct[]), данные о товаре (IProduct), результат заказа (IOrderResult).

## Компоненты данных
1. **OrderPayments**
Форма для выбора способа оплаты и ввода адреса доставки.
Связи:
- Обновляет модель AppState через события order.<field>:change и order:change payment.
- Переходит к форме контактов через событие order:submit.
Данные: Способ оплаты (payment), адрес доставки (address), валидность формы (valid), ошибки (errors).

2. **OrderContacts**
Форма для ввода email и телефона.
Связи:
- Обновляет модель AppState через события contacts.<field>:change.
- Отправляет заказ через событие contacts:submit.
Данные: Email (email), телефон (phone), валидность формы (valid), ошибки (errors).

## Компоненты отображения
1. **Page**
Главная страница приложения, отображает каталог товаров, счетчик корзины и кнопку открытия корзины.
Связи:
- Получает данные каталога из AppState через событие items:changed.
- Открывает корзину через событие basket:open.
- Блокирует прокрутку страницы при открытии модального окна (modal:open).
Данные: Список HTML-элементов карточек товаров (catalog), счетчик товаров в корзине (counter), флаг блокировки прокрутки (locked).

2. **Modal**
Отображает модальное окно с динамическим содержимым (корзина, формы заказа, сообщение об успехе).
Связи:
- Получает контент для отображения от других компонентов (Basket, OrderPayments, OrderContacts, Success).
- Реагирует на события modal:open и modal:close для управления видимостью.
Данные: HTML-элемент содержимого модального окна (content).

3. **Basket**
Отображает список товаров в корзине, общую сумму и кнопку для перехода к оформлению заказа.
Связи:
- Получает данные о товарах из AppState через событие basket:changed.
- Открывает форму заказа через событие order:open.
Данные: Список HTML-элементов товаров (items), общая сумма (total), массив ID выбранных товаров (selected).

4. **Card** (CatalogItem, PreviewItem, BasketItem)
- CatalogItem: Отображает карточку товара в каталоге с заголовком, изображением, категорией и ценой.
- PreviewItem: Расширяет CatalogItem, добавляя описание и кнопку для добавления в корзину.
- BasketItem: Отображает товар в корзине с номером, заголовком, ценой и кнопкой удаления.
Связи:
- CatalogItem отображается на главной странице (Page) через событие items:changed.
- PreviewItem открывается в модальном окне через событие preview:changed.
- BasketItem используется в Basket через событие basket:changed.
Данные: Данные товара (IProduct: id, title, description, image, category, price).

5. **Success**
Отображает сообщение об успешном оформлении заказа с общей суммой и кнопкой закрытия.
Связи:
- Создается после успешной отправки заказа через API (LarekAPI.orderProducts).
- Очищает корзину и закрывает модальное окно через обработчик onClick.
Данные: Общая сумма заказа (total).

